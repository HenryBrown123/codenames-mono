<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Codenames - Operation Active</title>

    <!-- Link to the single source of truth for styles -->
    <link rel="stylesheet" href="design-system.css" />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
  </head>
  <body class="game-app">
    <div class="game-container" id="gameContainer">
      <!-- Desktop Sidebar -->
      <aside class="sidebar panel desktop-only">
        <div class="panel">
          <h3>Mission Briefing</h3>
          <p style="color: var(--color-text-muted)">
            Decode your agents. Avoid enemy operatives and the assassin.
          </p>
        </div>

        <div class="clue-display">
          <h4>Current Intel</h4>
          <div class="clue-text">OCEAN 3</div>
        </div>

        <div>
          <h4>Card States</h4>
          <div style="display: flex; flex-direction: column; gap: 0.5rem">
            <button class="btn btn-primary" onclick="showUnclassified()">Reset Cards</button>
            <button class="btn btn-primary" onclick="showClassified()">Reveal Teams</button>
            <button class="btn btn-primary" onclick="showSpymaster()">Spymaster View</button>
          </div>
        </div>
      </aside>

      <!-- Mobile Header -->
      <header class="mobile-header panel mobile-only">
        <h3>Mission Briefing</h3>
        <p style="color: var(--color-text-muted)">
          Decode your agents. Avoid enemy operatives and the assassin.
        </p>
      </header>

      <!-- Board Area -->
      <main class="board-area">
        <div class="game-board" id="gameBoard">
          <!-- Cards will be generated by JavaScript -->
        </div>
      </main>

      <!-- Mobile Dashboard -->
      <div class="mobile-dashboard panel mobile-only">
        <div class="clue-display">
          <h4>Current Intel</h4>
          <div class="clue-text">OCEAN 3</div>
        </div>
        <button class="btn btn-primary" onclick="cycleCardState()">Cycle View</button>
      </div>
    </div>

    <!-- Help Button -->
    <button class="help-button mobile-only" id="helpButton">?</button>

    <script>
      // NOTE: This JavaScript still uses the OLD card classes.
      // The next step would be to update this script to generate
      // the new, simpler card components.

      const gameWords = [
        "WAVE",
        "SAND",
        "FISH",
        "BOAT",
        "STAR",
        "MOON",
        "TREE",
        "ROCK",
        "BIRD",
        "CLOUD",
        "RAIN",
        "SNOW",
        "FIRE",
        "WATER",
        "EARTH",
        "WIND",
        "GOLD",
        "SILVER",
        "IRON",
        "WOOD",
        "GLASS",
        "PAPER",
        "STONE",
        "METAL",
        "LIGHT",
      ];
      const cardTeams = [
        "red",
        "red",
        "neutral",
        "red",
        "red",
        "blue",
        "blue",
        "neutral",
        "blue",
        "red",
        "red",
        "assassin",
        "red",
        "red",
        "red",
        "blue",
        "blue",
        "blue",
        "neutral",
        "neutral",
        "blue",
        "blue",
        "neutral",
        "neutral",
        "neutral",
      ];
      const teamSymbols = {
        red: '<i class="fa-solid fa-caret-down"></i>',
        blue: '<i class="fa-solid fa-moon"></i>',
        neutral: '<i class="fa-solid fa-minus"></i>',
        assassin: "â˜ ",
      };

      let currentState = "unclassified";
      let mobileStateIndex = 0;

      function createCard(word, index) {
        const team = cardTeams[index];
        const symbol = teamSymbols[team];
        return `
          <div class="card-container" data-team="${team}" style="--card-index: ${index};">
            <div class="base-card">
              <div class="paper-texture"></div>
              <span class="word-text">${word}</span>
              <div class="spymaster-symbol ${team === "assassin" ? "danger" : ""}">${symbol}</div>
            </div>
            <div class="cover-card ${team}">
              <div class="paper-texture"></div>
              <div class="cover-symbol ${team === "assassin" ? "assassin" : ""}">${symbol}</div>
            </div>
          </div>
        `;
      }

      function initializeBoard() {
        const gameBoard = document.getElementById("gameBoard");
        gameBoard.innerHTML = gameWords.map((word, index) => createCard(word, index)).join("");
        setTimeout(() => {
          document.querySelectorAll(".base-card").forEach((card) => card.classList.add("dealing"));
        }, 100);
      }

      function showUnclassified() {
        currentState = "unclassified";
        document
          .querySelectorAll(".base-card")
          .forEach((card) =>
            card.classList.remove(
              "spymaster-red",
              "spymaster-blue",
              "spymaster-neutral",
              "spymaster-assassin",
            ),
          );
        document
          .querySelectorAll(".spymaster-symbol")
          .forEach((symbol) => symbol.classList.remove("visible"));
        document
          .querySelectorAll(".cover-card")
          .forEach((card) => card.classList.remove("visible", "dealing"));
      }

      function showClassified() {
        currentState = "classified";
        showUnclassified(); // Reset first
        setTimeout(() => {
          document.querySelectorAll(".cover-card").forEach((card, index) => {
            setTimeout(() => card.classList.add("dealing", "visible"), index * 50);
          });
        }, 100);
      }

      function showSpymaster() {
        currentState = "spymaster";
        document
          .querySelectorAll(".cover-card")
          .forEach((card) => card.classList.remove("visible", "dealing"));
        document.querySelectorAll(".card-container").forEach((container, index) => {
          const team = container.dataset.team;
          const baseCard = container.querySelector(".base-card");
          const symbol = container.querySelector(".spymaster-symbol");
          setTimeout(() => {
            baseCard.classList.add(`spymaster-${team}`);
            symbol.classList.add("visible");
          }, index * 30);
        });
      }

      function cycleCardState() {
        const states = ["unclassified", "classified", "spymaster"];
        mobileStateIndex = (mobileStateIndex + 1) % states.length;
        if (mobileStateIndex === 0) showUnclassified();
        else if (mobileStateIndex === 1) showClassified();
        else showSpymaster();
      }

      function handleCardClick(event) {
        const container = event.currentTarget;
        const coverCard = container.querySelector(".cover-card");
        if (currentState === "unclassified" || currentState === "classified") {
          coverCard.classList.toggle("visible");
        }
      }

      const helpButton = document.getElementById("helpButton");
      const gameContainer = document.getElementById("gameContainer");
      helpButton.addEventListener("click", () => {
        gameContainer.classList.toggle("instructions-hidden");
        helpButton.classList.toggle("active");
        helpButton.textContent = helpButton.classList.contains("active") ? "!" : "?";
      });

      document.addEventListener("DOMContentLoaded", () => {
        initializeBoard();
        document.addEventListener("click", (e) => {
          const cardContainer = e.target.closest(".card-container");
          if (cardContainer) handleCardClick({ currentTarget: cardContainer });
        });
      });
    </script>
  </body>
</html>
